<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="renderer" content="webkit">
  		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>网站后台管理模版</title>
		<link rel="stylesheet" type="text/css" href="../../static/admin/layui/css/layui.css"/>
		<link rel="stylesheet" type="text/css" href="../../static/admin/css/admin.css"/>
		<script src="../../static/admin/jquery/jquery.js"></script>
		<script src="../../static/admin/jquery/jquery-form.js"></script>
		<script src="../../static/admin/jquery/jquery.cookie.js"></script>
	</head>
	<body>
		<div class="layui-tab page-content-wrap">
		  <ul class="layui-tab-title">
		    <li class="layui-this">修改资料</li>
		    <li>修改密码</li>
		  </ul>
		  <div class="layui-tab-content">
		    <div class="layui-tab-item layui-show">
		    	<form class="layui-form" id="myInfoForm"  style="width: 90%;padding-top: 20px;">
				  <div class="layui-form-item">
				    <label class="layui-form-label">ID：</label>
				    <div class="layui-input-block">
				      <input type="text" name="id" readonly autocomplete="off" class="layui-input layui-disabled" value="">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">用户名：</label>
				    <div class="layui-input-block">
				      <input type="text" name="userName" disabled autocomplete="off" class="layui-input layui-disabled" value="">
				    </div>
				  </div>
				   <div class="layui-form-item">
				    <label class="layui-form-label">姓名：</label>
				    <div class="layui-input-block">
				      <input type="text" name="name" required  lay-verify="required" placeholder="" autocomplete="off" class="layui-input" value="">
				    </div>
				  </div>
					<div class="layui-form-item">
						<label class="layui-form-label">身份证：</label>
						<div class="layui-input-block">
							<input type="text" name="idCard" required  lay-verify="required" placeholder="" autocomplete="off" class="layui-input" value="">
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">性别：</label>
						<div class="layui-input-block">
							<select name="sex" id="sex">
								<option value="0">未知</option>
								<option value="1">男</option>
								<option value="2">女</option>
							</select>
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">手机号码：</label>
						<div class="layui-input-block">
							<input type="text" name="phone" required  lay-verify="required" placeholder="" autocomplete="off" class="layui-input" value="">
						</div>
					</div>
				    <div class="layui-form-item">
						<label class="layui-form-label">邮箱：</label>
						<div class="layui-input-block">
							<input type="text" name="email" required  lay-verify="required" placeholder="" autocomplete="off" class="layui-input" value="">
						</div>
				    </div>
					<div class="layui-form-item">
						<label class="layui-form-label">角色：</label>
						<div class="layui-input-block">
							<!--<input type="text" name="type" required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input layui-disabled" value="未知">-->
							<input type="radio" name="type" disabled value="1" title="管理员">
							<input type="radio" name="type" disabled value="2" title="普通用户" >
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">状态：</label>
						<div class="layui-input-block">
							<!--<input type="text" name="status" required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input layui-disabled" value="未知">-->
							<input type="radio" name="status" disabled value="1" title="启用">
							<input type="radio" name="status" disabled value="2" title="禁用" >
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">注册时间：</label>
						<div class="layui-input-block">
							<input type="text" disabled name="createTime" required  lay-verify="required" placeholder="" autocomplete="off" class="layui-input layui-disabled" value="">
						</div>
					</div>
				  <div class="layui-form-item">
				    <div class="layui-input-block">
						<!--lay-submit  lay-filter="adminInfo"-->
				        <button class="layui-btn layui-btn-normal" type="button" onclick="updateMyInfo()">立即提交</button>
				    </div>
				  </div>
				</form>
		    </div>
		    <div class="layui-tab-item">
		    	<form class="layui-form" id="passwordForm" style="width: 90%;padding-top: 20px;">
				  <div class="layui-form-item">
				    <label class="layui-form-label">用户名：</label>
				    <div class="layui-input-block">
				      <input type="text" name="userNameReset" disabled autocomplete="off" class="layui-input layui-disabled" value="">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">旧密码：</label>
				    <div class="layui-input-block">
				      <input type="password" name="oldPassword" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <label class="layui-form-label">新密码：</label>
				    <div class="layui-input-block">
				      <input type="password" name="newPassword" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
				    </div>
				  </div>
				  <div class="layui-form-item">
				    <div class="layui-input-block">
						<!--lay-submit lay-filter="adminPassword"-->
				      <button class="layui-btn layui-btn-normal" type="button" onclick="updatePassword()">立即提交</button>
				    </div>
				  </div>
				</form>
		    </div>
		  </div>
		</div>
		<script src="../../static/admin/layui/layui.js" type="text/javascript" charset="utf-8"></script>
		<!--<script type="text/javascript">-->
            <!--$(function () {-->
                <!--init();-->
            <!--})-->
		<!--</script>-->
		<script type="text/javascript">
			layui.use(['util','form'],function init() {
			    var util = layui.util
				var form = layui.form
				var nowUserName = $.cookie("userName")
				// 初始化修改密码tab的用户名
				$('input[name="userNameReset"]').val(nowUserName)
				// 初始化个人信息tab
				$.ajax({
					//几个参数需要注意一下
					type: "get",//方法类型
					dataType: "json",//预期服务器返回的数据类型
					url: "/myInfo/" + nowUserName ,//url
					success: function (response) {
						if (response.code == 0) {
							$('input[name="id"]').val(response.id)
							$('input[name="userName"]').val(response.userName)
							$('input[name="name"]').val(response.name)
							$('input[name="idCard"]').val(response.idCard)
							$('select[name="sex"]').val(response.sex)
							$('input[name="phone"]').val(response.phone)
							$('input[name="email"]').val(response.email)
							$("input[name='type'][value=" + response.type + "]").attr("checked", true);
							$("input[name='status'][value=" + response.status + "]").attr("checked", true);
                            $('input[name="createTime"]').val(util.toDateString(response.createTime))
                            form.render();
						}else
                            layer.alert(response.message, {icon: 7,time:2000});
                        	//alert(response.message);
					},
					error : function() {
                        layer.alert("系统请求失败", {icon: 7,time:2000});
						//alert("系统请求失败");
					}
				});
            })
		</script>
		<script type="text/javascript">
			function updateMyInfo() {
                $.ajax({
                    //几个参数需要注意一下
                    type: "post",//方法类型
                    dataType: "json",//预期服务器返回的数据类型
                    url: "/updateMyInfo" ,//url
					data: $("#myInfoForm").serialize(),
                    success: function (response) {
                        if (response.code == 0) {
                            layer.alert('修改成功', {icon: 6,time:2000});
                            // $("#myInfoForm").reload()
                            //window.location.reload();
                            // form.render();
                            // reset();
                        }else
                            layer.alert(response.message, {icon: 7,time:2000});
                            //alert(response.message);
                    },
                    error : function() {
                        layer.alert("系统请求失败", {icon: 7,time:2000});
                        //alert("系统请求失败");
                    }
                });
            }
		</script>
		<script type="text/javascript">
			function updatePassword() {
                $.ajax({
                    //几个参数需要注意一下
                    type: "post",//方法类型
                    dataType: "json",//预期服务器返回的数据类型
                    url: "/reset" ,//url
                    data: $("#passwordForm").serialize(),
                    success: function (response) {
                        if (response.code == 0) {
                            layer.alert('修改成功', {icon: 6,time:2000});
                            // $("#passwordForm").reload()
                            //window.location.reload();
                            // form.render();
                            // reset();
                        }else
                            layer.alert(response.message, {icon: 7,time:2000});
							//alert(response.message);
                    },
                    error : function() {
                        layer.alert("系统请求失败", {icon: 7,time:2000});
                        //alert("系统请求失败");
                    }
                });
            }
		</script>
		<script>
            //Demo
            layui.use(['form','element','jquery'], function(){
                var form = layui.form;
                //var element = layui.element();
                var element = layui.element;
                form.render();
                //监听信息提交
                form.on('submit(adminInfo)', function(data){
                    layer.msg(JSON.stringify(data.field));
                    return false;
                });
                //监听密码提交
                form.on('submit(adminPassword)', function(data){
                    layer.msg(JSON.stringify(data.field));
                    return false;
                });
            });
		</script>
	</body>
</html>